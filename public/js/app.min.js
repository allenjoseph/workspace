/* Minified on Thu Aug 07 2014 00:20:25*/
window.Workspace={},Workspace.Models={},Workspace.Collections={},Workspace.Views={},Workspace.Routers={},window.app={},window.collections={},window.models={},window.views={},window.routers={},Workspace.Models.UserModel=Backbone.Model.extend({initialize:function(a){this.set("id",a._id)}}),Workspace.Models.ToDoModel=Backbone.Model.extend({initialize:function(a){this.set("id",a._id)}}),Workspace.Models.PostModel=Backbone.Model.extend({initialize:function(a){this.set("id",a._id)}}),Workspace.Views.UserView=Backbone.View.extend({tagName:"li",className:"user-li",template:_.template($("#user-template").html()),initialize:function(a){var b=this;this.model=a,this.model.on("change",function(){b.render()})},render:function(){var a=this.model.toJSON();return this.$el.attr("id",a._id),this.$el.html(this.template({user:a})),this}}),Workspace.Views.ToDoView=Backbone.View.extend({tagName:"li",className:"task-li",template:_.template($("#todo-template").html()),events:{"click .todo-delete":"deleteToDo","change input[type=checkbox]":"changeToDo"},initialize:function(a){var b=this;this.model=a,this.model.on("change",function(){b.render()})},render:function(){var a=this.model.toJSON();return this.$el.html(this.template({todo:a})),this},changeToDo:function(){var a=this,b=this.$el.find("input[type=checkbox]");b.is(":checked")?$.post("/todo/complete/"+this.model.id,function(b){b.success&&a.$el.find("span.save").show().delay(1e3).fadeOut()}):$.post("/todo/incomplete/"+this.model.id,function(b){b.success&&a.$el.find("span.save").show().delay(1e3).fadeOut()})},deleteToDo:function(){var a=this,b=$.post("/todo/delete/"+a.model.id);b.done(function(b){b.success&&window.collections.todos.remove(a.model)})}}),Workspace.Views.PostView=Backbone.View.extend({tagName:"li",className:"post-li",template:_.template($("#post-template").html()),initialize:function(a){this.model=a},render:function(){var a=this.model.toJSON();return this.$el.html(this.template({post:a})),this}}),Workspace.Views.MainView=Backbone.View.extend({el:"#page-wrapper",events:{"click #todo-form-button":"addTodo","click #post-form-button":"addPost"},initialize:function(){var a=this;window.routers.base.on("route:home",function(){a.render()}),window.routers.base.on("route:todo",function(){a.render()}),window.routers.base.on("route:chat",function(){a.render()}),this.template_todo=_.template($("#todo-main-template").html()),this.template_chat=_.template($("#chat-main-template").html())},addTodo:function(a){a.preventDefault();var b=this,c=$("#todo-form").serialize();$.post("/todo/create",c,function(a){a.success&&(window.collections.todos.add(a.todo),b.$el.find("#todo-form-task").val(""))})},addPost:function(a){a.preventDefault();var b=this,c=$("#post-form").serialize();$.post("/chat/create-post",c,function(a){a.success&&(window.collections.posts.add(a.post),b.$el.find("#post-form-msg").val(""))})},render:function(){if("todo"===window.app.state){this.$el.find("#page-header h1").html("ToDo"),this.$el.find("#page-main").html(this.template_todo());{$.get("/todos",function(a){$.each(a.todos,function(a,b){window.collections.todos.add(b)})})}}else"chat"===window.app.state?(this.$el.find("#page-header h1").html("Chat"),this.$el.find("#page-main").html(this.template_chat())):this.$el.find("#page-header h1").html("Home");return this}}),Workspace.Collections.UserCollection=Backbone.Collection.extend({model:Workspace.Models.UserModel,initialize:function(){this.on("add",this.addListener),this.on("remove",this.removeListener)},addListener:function(a){var b=new Workspace.Views.UserView(a);b.render(),b.$el.appendTo("#chat-users")},removeListener:function(a){$("#chat-users li#"+a.id).remove()}}),Workspace.Collections.ToDoCollection=Backbone.Collection.extend({model:Workspace.Models.ToDoModel,initialize:function(){this.on("add",this.addListener),this.on("remove",this.removeListener)},addListener:function(a){var b=new Workspace.Views.ToDoView(a);b.render(),b.$el.appendTo("#todo-list")},removeListener:function(a){$("#todo-list li#"+a.id).remove()}}),Workspace.Collections.PostCollection=Backbone.Collection.extend({model:Workspace.Models.PostModel,initialize:function(){this.on("add",this.addListener)},addListener:function(a){var b=new Workspace.Views.PostView(a);b.render(),b.$el.appendTo("#chat-posts")}}),Workspace.Routers.BaseRouter=Backbone.Router.extend({routes:{"":"root",home:"home",chat:"chat",todo:"todo"},root:function(){$("#page-header h1").html("Welcome")},home:function(){window.app.state="home"},chat:function(){window.app.state="chat"},todo:function(){window.app.state="todo"}}),$(document).ready(function(){window.io=io.connect(),io.on("connect",function(){console.log("IO connected")}),window.collections.users=new Workspace.Collections.UserCollection,window.collections.todos=new Workspace.Collections.ToDoCollection,window.collections.posts=new Workspace.Collections.PostCollection,window.routers.base=new Workspace.Routers.BaseRouter;var a=new Workspace.Views.MainView;a.render(),$("#nav-button-chat").on("click",function(){Backbone.history.navigate("chat",{trigger:!0})}),$("#nav-button-todo").on("click",function(){Backbone.history.navigate("todo",{trigger:!0})});var b=$.get("/users");b.done(function(a){0!=a.users.length&&$.each(a.users,function(a,b){window.collections.users.add(b)})}),io.on("log-in",function(a){window.collections.users.add(a.user)}),io.on("log-out",function(a){var b=window.collections.users.get(a.userid);window.collections.users.remove(b)}),io.on("post",function(a){window.collections.posts.add(a.post)}),Backbone.history.start({root:"/",pushState:!0,silent:!1})});